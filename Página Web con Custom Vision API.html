<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Reto Master Custom Vision API</title>
</head>
<body>
    <h1 id="titulo" class="titulo-class">Identifica el animal</h1>
    <p id="instrucciones" style="border: 2px,solid,blue;">
        Ingresa la URL de una imagen de un animal
    </p>

    <form id="MyForm">
        <input id="url" type="url" placeholder="URL de la imagen">
        <!--<input type="password">-->
        <button type="button" onclick="sendtoAzureApi()">Enviar</button>
    </form>

    <p id="result_space"></p>

</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script>

    function sendtoAzureApi(){
        const url=document.getElementById("url").value;
        $.ajax({
            url:"[endpoint-URL]",
            beforeSend: function(xhrObj) {
                xhrObj.setRequestHeader("Content-Type", "application/json");
                xhrObj.setRequestHeader("Prediction-Key", "[Prediction-Key]");
            },
            type: "POST",
            data: '{"URL": " ' + url + ' "}""',
        })
        .done(function (data){
            var majorElement = "";
            var majorProbability = 0;
            data.predictions.forEach(element => {
                if (majorProbability < element.probability) {
                    majorProbability = element.probability
                    majorElement = element.tagName
                }
            });
            
            const finalPrediction = round(majorProbability * 100);

            switch (majorElement) {
                case "Picasso":
                    document.getElementById("result_space").innerHTML="La foto que me mandaste es de un Picasso con probabilidad del " + finalPrediction + " %"
                    break;
                case "Rembrandt":
                    document.getElementById("result_space").innerHTML="La foto que me mandaste es de un Rembrandt con probabilidad del " + finalPrediction + " %"
                    break;
                case "cuadro":
                    document.getElementById("result_space").innerHTML="La foto que me mandaste es de un cuadro con probabilidad del " + finalPrediction + " %"
                    break;
                default:
                    document.getElementById("result_space").innerHTML="No puedo identificarlo"
            }

            console.log(round(majorProbability));

        })
        .fail(function(){
            document.getElementById("result_space").innerHTML="Hubo un error en la ejecuciÃ³n"
        })

    }

    function round(num,decimales = 2) {
        var signo = (num >= 0 ? 1 : -1);
        num = num * signo;
        if (decimales === 0)
            return signo * Math.round(num)

        num = num.toString().split('e');
        num = Math.round(+(num[0] + 'e' + (num[1] ? (+num[1] + decimales) : decimales) ) );

        num = num.toString().split('e');
        return Math.round(+(num[0] + 'e' + (num[1] ? (+num[1] - decimales) : -decimales) ) );  
    }

</script>